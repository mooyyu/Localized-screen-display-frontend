<template>
    <div class="main w-100 mx-0 bg-light p-3">
        <div class="showSvg mx-auto w-100 mb-3 border rounded">
            <svg viewBox="0 0 300 100" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <pattern id="pattern-0" x="0" y="0" width="25" height="25" patternUnits="userSpaceOnUse" viewBox="0 0 100 100">
                        <rect x="0" y="0" width="50" height="100" style="fill: black;"></rect>
                    </pattern>
                    <linearGradient id="gradient-12" gradientUnits="userSpaceOnUse" x1="141.091" y1="32.362" x2="141.091" y2="47.795">
                        <stop offset="0" style="stop-color: rgb(5, 106, 169);"></stop>
                        <stop offset="1" style="stop-color: rgb(59, 102, 128);"></stop>
                    </linearGradient>
                    <linearGradient id="gradient-13" gradientUnits="userSpaceOnUse" x1="502.316" y1="189.302" x2="502.316" y2="229.652" gradientTransform="matrix(0.929735, 0.36823, -0.360324, 0.909774, 103.505448, -167.887779)">
                        <stop offset="0" style="stop-color: rgb(33, 74, 99);"></stop>
                        <stop offset="1" style="stop-color: rgb(56, 167, 235);"></stop>
                    </linearGradient>
                    <linearGradient id="gradient-1" gradientUnits="userSpaceOnUse" x1="502.316" y1="189.302" x2="502.316" y2="229.652" gradientTransform="matrix(0.929735, 0.36823, -0.360324, 0.909774, 103.505448, -167.887779)">
                        <stop offset="0" style="stop-color: rgb(33, 74, 99);"></stop>
                        <stop offset="1" style="stop-color: rgb(56, 167, 235);"></stop>
                    </linearGradient>
                    <linearGradient id="gradient-2" gradientUnits="userSpaceOnUse" x1="141.091" y1="32.362" x2="141.091" y2="47.795">
                        <stop offset="0" style="stop-color: rgb(5, 106, 169);"></stop>
                        <stop offset="1" style="stop-color: rgb(59, 102, 128);"></stop>
                    </linearGradient>
                    <linearGradient id="gradient-3" gradientUnits="userSpaceOnUse" x1="502.316" y1="189.302" x2="502.316" y2="229.652" gradientTransform="matrix(0.929735, 0.36823, -0.360324, 0.909774, 103.505448, -167.887779)">
                        <stop offset="0" style="stop-color: rgb(33, 74, 99);"></stop>
                        <stop offset="1" style="stop-color: rgb(56, 167, 235);"></stop>
                    </linearGradient>
                    <linearGradient id="gradient-4" gradientUnits="userSpaceOnUse" x1="141.091" y1="32.362" x2="141.091" y2="47.795">
                        <stop offset="0" style="stop-color: rgb(5, 106, 169);"></stop>
                        <stop offset="1" style="stop-color: rgb(59, 102, 128);"></stop>
                    </linearGradient>
                </defs>
                <rect x="105" y="0" width="90" height="100" style="fill: rgb(216, 216, 216);"></rect>
                <rect x="105" y="20" width="90" height="70" style="fill: rgb(71, 145, 216);"></rect>
                <g transform="matrix(1, 0, 0, 1, -0.705485, -0.707548)">
                    <g transform="matrix(1, 0, 0, 1, 17.516459, 0.352736)">
                        <!--suppress HtmlUnknownAttribute, XmlUnboundNsPrefix -->
                        <path style="paint-order: stroke; fill: url(#gradient-13);" transform="matrix(0.264041, 0, 0, 0.264041, -10.050696, -11.239764)" d="M 486.523 229.652 A 33.163 33.163 0 0 1 518.898 189.302 L 518.898 205.937 A 16.528 16.528 0 0 0 502.763 226.047 Z" bx:shape="pie 518.898 222.465 16.528 33.163 257.483 360 1@233831b4"></path>
                        <!--suppress HtmlUnknownAttribute, XmlUnboundNsPrefix -->
                        <path d="M 139.305 34.875 Q 141.091 29.85 142.877 34.875 L 145.683 42.77 Q 147.469 47.795 143.897 47.795 L 138.285 47.795 Q 134.713 47.795 136.499 42.77 Z" style="paint-order: stroke; fill: url(#gradient-12);" transform="matrix(0, 1, -1, 0, 173.794998, -101.142204)" bx:shape="triangle 134.713 29.85 12.756 17.945 0.5 0.28 1@de246d56"></path>
                        <animate attributeName="opacity" values="0;0.5;1;0.5;0" dur="5s" repeatCount="indefinite"></animate>
                    </g>
                    <g transform="matrix(-0.5, -0.866025, 0.866025, -0.5, 165.023834, 200.211639)">
                        <!--suppress HtmlUnknownAttribute, XmlUnboundNsPrefix -->
                        <path style="paint-order: stroke; fill: url(#gradient-1);" transform="matrix(0.264041, 0, 0, 0.264041, -10.050696, -11.239764)" d="M 486.523 229.652 A 33.163 33.163 0 0 1 518.898 189.302 L 518.898 205.937 A 16.528 16.528 0 0 0 502.763 226.047 Z" bx:shape="pie 518.898 222.465 16.528 33.163 257.483 360 1@233831b4"></path>
                        <!--suppress HtmlUnknownAttribute, XmlUnboundNsPrefix -->
                        <path d="M 139.305 34.875 Q 141.091 29.85 142.877 34.875 L 145.683 42.77 Q 147.469 47.795 143.897 47.795 L 138.285 47.795 Q 134.713 47.795 136.499 42.77 Z" style="paint-order: stroke; fill: url(#gradient-2);" transform="matrix(0, 1, -1, 0, 173.794998, -101.142204)" bx:shape="triangle 134.713 29.85 12.756 17.945 0.5 0.28 1@de246d56"></path>
                        <animate attributeName="opacity" values="0.5;1;0.5;0;0.5" dur="5s" repeatCount="indefinite"></animate>
                    </g>
                    <g transform="matrix(-0.5, 0.866025, -0.866025, -0.5, 265.323059, -27.917562)">
                        <!--suppress HtmlUnknownAttribute, XmlUnboundNsPrefix -->
                        <path style="paint-order: stroke; fill: url(#gradient-3);" transform="matrix(0.264041, 0, 0, 0.264041, -10.050696, -11.239764)" d="M 486.523 229.652 A 33.163 33.163 0 0 1 518.898 189.302 L 518.898 205.937 A 16.528 16.528 0 0 0 502.763 226.047 Z" bx:shape="pie 518.898 222.465 16.528 33.163 257.483 360 1@233831b4"></path>
                        <!--suppress HtmlUnknownAttribute, XmlUnboundNsPrefix -->
                        <path d="M 139.305 34.875 Q 141.091 29.85 142.877 34.875 L 145.683 42.77 Q 147.469 47.795 143.897 47.795 L 138.285 47.795 Q 134.713 47.795 136.499 42.77 Z" style="paint-order: stroke; fill: url(#gradient-4);" transform="matrix(0, 1, -1, 0, 173.794998, -101.142204)" bx:shape="triangle 134.713 29.85 12.756 17.945 0.5 0.28 1@de246d56"></path>
                        <animate attributeName="opacity" values="1;0.5;0;0.5;1" dur="5s" repeatCount="indefinite"></animate>
                    </g>
                </g>
            </svg>
        </div>
        <div class="alert alert-light border" role="alert">
            <h6 class="alert-heading">简单轮播</h6>
            <hr class="my-0">
            <p class="mb-0">适合宽高比7:10至2:1的小型屏幕。</p>
        </div>
        <div class="row">
            <div class="col-6">
                <nav :style="'background-color: ' + colors[1] + ';'" class="nav border py-1 h5">
                    <span class="mx-auto text-center">显示</span>
                </nav>
                <draggable class="list-group-flush border" :list="showList" group="list">
                    <div class="list-group-item" v-for="item in showList" :key="item.name + item.id">
                        {{ item.name }}
                    </div>
                </draggable>
            </div>
            <div class="col-6">
                <nav :style="'background-color: ' + colors[0] + ';'" class="nav border py-1 h5">
                    <span class="mx-auto text-center">隐藏</span>
                </nav>
                <draggable class="list-group-flush border" :list="hideList" group="list">
                    <div class="list-group-item" v-for="item in hideList" :key="item.name + item.id">
                        {{ item.name }}
                    </div>
                </draggable>
            </div>
        </div>
        <div class="btn-group w-100 mx-auto mt-3" role="group">
            <button @click="useDefaultList" type="button" class="btn btn-outline-primary">使用默认</button>
            <button @click="submit" type="button" class="btn btn-outline-success">确认提交</button>
        </div>
        <modal id="modulePanel" title="提交信息" :body="modalBody"></modal>
    </div>
</template>

<script>
    import draggable from 'vuedraggable';

    import modal from "@components/bootstrap/modal";
    import 'bootstrap/dist/js/bootstrap.min'
    import $ from 'jquery'

    export default {
        name: "ctrlView",
        components: {
            modal, draggable
        },
        props: {
            overviewStatus: Object
        },
        data() {
            return {
                colors: [
                    'rgb(216, 216, 216)',
                    'rgb(71,145,216)'
                ],
                showList: null,
                hideList: null,
                modalBody: '',
                defaultList: 'acdefghj-bi'
            }
        },
        mounted() {
            if (this.overviewStatus.panelCode === this.$parent.rawPanelCode) {
                this.showList = this.global.moduleList.filter(item => this.overviewStatus.moduleCodeList.split('-')[0].indexOf(item.id) > -1);
                this.hideList = this.global.moduleList.filter(item => this.overviewStatus.moduleCodeList.split('-')[1].indexOf(item.id) > -1);
                this.showList.sort((a, b) => this.overviewStatus.moduleCodeList.split('-')[0].indexOf(a.id) - this.overviewStatus.moduleCodeList.split('-')[0].indexOf(b.id));
                this.hideList.sort((a, b) => this.overviewStatus.moduleCodeList.split('-')[1].indexOf(a.id) - this.overviewStatus.moduleCodeList.split('-')[1].indexOf(b.id));
            } else {
                this.useDefaultList()
            }
        },
        methods: {
            submit() {
                let newModuleCodeList = this.showList.map(item => item.id).join("") + "-" + this.hideList.map(item => item.id).join("");
                this.global.axios.post(this.global.serverHost + '/backStage/setOverviewStatus', {
                    panelCode: 2,
                    moduleCodeList: newModuleCodeList
                }, {
                    withCredentials: true
                }).then(() => {
                    this.modalBody = "更新成功";
                    $('div#modulePanelModal').on('hidden.bs.modal', () => {window.location.reload()})
                }).catch(e => {
                    // eslint-disable-next-line no-console
                    console.info(e);
                    this.modalBody = "失败!";
                }).finally(() => {
                    $('div#modulePanelModal').modal('show')
                })
            },
            useDefaultList() {
                this.showList = this.global.moduleList.filter(item => this.defaultList.split('-')[0].indexOf(item.id) > -1);
                this.hideList = this.global.moduleList.filter(item => this.defaultList.split('-')[1].indexOf(item.id) > -1);
                this.showList.sort((a, b) => this.defaultList.split('-')[0].indexOf(a.id) - this.defaultList.split('-')[0].indexOf(b.id));
                this.hideList.sort((a, b) => this.defaultList.split('-')[1].indexOf(a.id) - this.defaultList.split('-')[1].indexOf(b.id));
            }
        }
    }
</script>

<style scoped>

</style>